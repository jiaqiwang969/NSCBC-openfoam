disp('Computing the conservative and dissipative mechanisms')

for i_f=1:length(in.f);
    
    % Plane wave def
    omega=2*pi*in.f(i_f);
    k_eq=omega/co;
    k_x=k_eq*in.k_ax;
    k_y=k_eq*in.k_ay;
    k_z=k_eq*in.k_az;
    
    for ii=1:length(L)
        switch L(ii).material.type

            case 'fluid'
                [L(ii).disspow.tot(i_f),...
                    L(ii).kinen.x(i_f),L(ii).kinen.y(i_f),L(ii).kinen.z(i_f),L(ii).kinen.tot(i_f),...
                    L(ii).kinpow.x(i_f),L(ii).kinpow.y(i_f),L(ii).kinpow.z(i_f),L(ii).kinpow.tot(i_f),...
                    ] =...
                    En_Fluid(...
                    L(ii).Alpha(:,:,i_f),...
                    L(ii).PHI(:,:,i_f),...
                    L(ii).wave.num(:,i_f),...
                    L(ii).d,...
                    L(ii).material.rho,...
                    L(ii).material.K,...
                    omega,k_x,k_y,...
                    L(ii).wave.q(:,i_f));
                
                
            case 'solid'
                [L(ii).disspow.tot(i_f),...
                    L(ii).kinen.x(i_f),L(ii).kinen.y(i_f),L(ii).kinen.z(i_f),L(ii).kinen.tot(i_f),...
                    L(ii).kinpow.x(i_f),L(ii).kinpow.y(i_f),L(ii).kinpow.z(i_f),L(ii).kinpow.tot(i_f),...
                    ] =...
                    En_Solid(...
                    L(ii).Alpha(:,:,i_f),...
                    L(ii).PHI(:,:,i_f),...
                    L(ii).wave.num(:,i_f),...
                    L(ii).d,...
                    L(ii).material.rho,...
                    L(ii).material.C,...
                    omega,k_x,k_y,...
                    L(ii).wave.q(:,i_f));
                
            case 'pem'
                [L(ii).disspow.struct.tot(i_f),...
                    L(ii).disspow.th(i_f),...
                    L(ii).disspow.vis_x(i_f),L(ii).disspow.vis_y(i_f),L(ii).disspow.vis_z(i_f),L(ii).disspow.vis(i_f),...
                    L(ii).disspow.tot(i_f),...
                    L(ii).kinen.struct.x(i_f),L(ii).kinen.struct.y(i_f),L(ii).kinen.struct.z(i_f),L(ii).kinen.struct.tot(i_f),...
                    L(ii).kinen.fluid.x(i_f),L(ii).kinen.fluid.y(i_f),L(ii).kinen.fluid.z(i_f),L(ii).kinen.fluid.tot(i_f),...
                    L(ii).kinen.tot(i_f),...
                    L(ii).kinpow.struct.x(i_f),L(ii).kinpow.struct.y(i_f),L(ii).kinpow.struct.z(i_f),L(ii).kinpow.struct.tot(i_f),...
                    L(ii).kinpow.fluid.x(i_f),L(ii).kinpow.fluid.y(i_f),L(ii).kinpow.fluid.z(i_f),L(ii).kinpow.fluid.tot(i_f),...
                    L(ii).kinpow.tot(i_f)] =...
                    En_PEM(...
                    L(ii).Alpha(:,:,i_f),...
                    L(ii).PHI(:,:,i_f),...
                    L(ii).wave.num(:,i_f),...
                    L(ii).d,omega,k_x,k_y,...
                    L(ii).material.rho_1,...
                    L(ii).material.rho_2,...
                    L(ii).material.rho_12_til(:,:,i_f),...
                    L(ii).material.rho_eq_til(:,:,i_f),...
                    L(ii).material.K_eq_til(i_f),...
                    L(ii).material.gamma_til(:,:,i_f),...
                    L(ii).material.phi,...
                    L(ii).material.tort,...
                    L(ii).material.sig,...
                    L(ii).material.LCV,...
                    L(ii).material.C,...
                    L(ii).wave.q(:,i_f));
        end
    end
end